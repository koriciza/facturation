{% extends "base.html" %}
{% block content %}

<style>
    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: bold;
        color: #2d3748;
        margin: 10px 0;
    }
    
    .stat-label {
        color: #718096;
        font-size: 14px;
        text-transform: uppercase;
    }
    
    .positive {
        color: #48bb78;
    }
    
    .negative {
        color: #f56565;
    }
    
    .client-row {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border: 1px solid #e2e8f0;
        transition: all 0.2s;
    }
    
    .client-row:hover {
        transform: translateX(5px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-left: 4px solid #4299e1;
    }
    
    .client-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
    }
    
    .client-details {
        display: none;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e2e8f0;
    }
    
    .client-details.show {
        display: block;
    }
    
    .print-btn {
        margin-bottom: 20px;
        text-align: right;
    }
    
    @media print {
        .no-print {
            display: none;
        }
        .client-details {
            display: block !important;
        }
    }
</style>

<div class="card">
    <div class="card-header">
        <h2>üìä Rapport tous clients</h2>
        <div class="no-print">
            <a href="{{ url_for('rapport_tous_clients') }}" class="btn btn-primary">‚Ü©Ô∏è Nouveau rapport</a>
            <button onclick="window.print()" class="btn btn-success">üñ®Ô∏è Imprimer</button>
        </div>
    </div>
    
    <!-- P√©riode -->
    <div style="text-align: center; margin-bottom: 20px; color: #718096;">
        P√©riode du {{ date_debut.strftime('%d/%m/%Y') }} au {{ date_fin.strftime('%d/%m/%Y') }}
    </div>
    
    <!-- Cartes de statistiques globales 
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-label">Total Factures</div>
            <div class="stat-value">{{ "{:,.0f}".format(total_general_factures).replace(',', ' ') }} FBU</div>
            <div>({{ nb_total_factures }} factures)</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Total Avoirs</div>
            <div class="stat-value negative">{{ "{:,.0f}".format(total_general_avoirs).replace(',', ' ') }} FBU</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Net global</div>
            <div class="stat-value positive">{{ "{:,.0f}".format(total_general_net).replace(',', ' ') }} FBU</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Clients actifs</div>
            <div class="stat-value">{{ nb_clients_actifs }}</div>
        </div>
    </div>-->
    
    <!-- R√©partition par mode de paiement
    {% if paiements %}
    <h3>üí∞ R√©partition par mode de paiement</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
        {% for mode, stats in paiements.items() %}
        <div class="stat-card">
            <div class="stat-label">{{ mode }}</div>
            <div class="stat-value">{{ "{:,.0f}".format(stats.total).replace(',', ' ') }} FBU</div>
            <div>{{ stats.count }} transaction{{ 's' if stats.count > 1 else '' }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %} -->
    
    <!-- D√©tail par client -->
    <h3>üìã D√©tail par client</h3>
    
    {% if stats_clients %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Client</th>
                    <th>Factures</th>
                    <th>Avoirs</th>
                    <th>Total Factur√©</th>
                    <th>Total Avoirs</th>
                    <th>Net</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in stats_clients %}
                <tr>
                    <td>
                        <strong>{{ stat.client.nom }} {{ stat.client.prenom or '' }}</strong>
                        {% if stat.client.telephone %}
                        <br><small>{{ stat.client.telephone }}</small>
                        {% endif %}
                    </td>
                    <td>{{ stat.nb_factures }}</td>
                    <td>{{ stat.nb_avoirs }}</td>
                    <td class="positive">{{ "{:,.0f}".format(stat.total_factures).replace(',', ' ') }} FBU</td>
                    <td class="negative">{{ "{:,.0f}".format(stat.total_avoirs).replace(',', ' ') }} FBU</td>
                    <td class="{% if stat.net >= 0 %}positive{% else %}negative{% endif %}">
                        <strong>{{ "{:,.0f}".format(stat.net).replace(',', ' ') }} FBU</strong>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr style="font-weight: bold; background: #f7fafc;">
                    <td>TOTAUX</td>
                    <td>{{ stats_clients|sum(attribute='nb_factures') }}</td>
                    <td>{{ stats_clients|sum(attribute='nb_avoirs') }}</td>
                    <td class="positive">{{ "{:,.0f}".format(total_general_factures).replace(',', ' ') }} FBU</td>
                    <td class="negative">{{ "{:,.0f}".format(total_general_avoirs).replace(',', ' ') }} FBU</td>
                    <td class="positive">{{ "{:,.0f}".format(total_general_net).replace(',', ' ') }} FBU</td>
                </tr>
            </tfoot>
        </table>
    </div>
    {% else %}
    <p class="text-center">Aucune activit√© sur cette p√©riode</p>
    {% endif %}
</div>

<script>
// Optionnel: rendre les lignes cliquables pour voir plus de d√©tails
document.querySelectorAll('.client-row .client-header').forEach(header => {
    header.addEventListener('click', function() {
        this.parentElement.querySelector('.client-details').classList.toggle('show');
    });
});
</script>

{% endblock %}